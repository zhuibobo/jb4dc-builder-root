<!DOCTYPE html>
<html lang="zh" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <th:block th:replace="Fragment/GeneralLib::GeneralLib"></th:block>
    <th:block th:replace="Fragment/GeneralLib::ThemesLib"></th:block>
    <style>

    </style>
</head>
<body>
<div id="gridManager" class="list-2column">
    <div class="left-outer-wrap" style="width: 450px">
        <div class="inner-wrap">
            <div class="tool-bar-wrap">
                <div alt="新增部门" title="新增部门" class="add" ></div>
                <div alt="修改部门" title="修改部门" class="edit"></div>
                <div alt="删除部门" title="删除部门" class="del" ></div>
                <div alt="浏览部门" title="浏览部门" class="view" ></div>
                <div alt="上移" title="上移" class="order-up" ></div>
                <div alt="下移" title="下移" class="order-down last"></div>
            </div>
            <div>
                <table>
                    <tr>
                        <td>
                            <radio-group type="button">
                                <radio label="true">我的建筑</radio>
                                <radio label="false">网格建筑</radio>
                            </radio-group>
                        </td>
                        <td>
                            <i-input search class="input_border_bottom" ref="txt_form_search_text" placeholder="请输入建筑物编号,或者地址" />
                        </td>
                    </tr>
                </table>
            </div>
            <div>
                <ul id="zTreeUL" class="ztree"></ul>
            </div>
        </div>
    </div>
    <div class="right-outer-wrap iv-list-page-wrap" style="padding: 10px;left: 460px">
        <div id="list-button-wrap" class="list-button-outer-wrap">
            <div class="list-button-inner-wrap">
                <button-group>
                    <i-button type="success" @click="add()" icon="md-add"> 新增 </i-button>
                    <i-button type="primary" icon="md-arrow-up" disabled> 上移 </i-button>
                    <i-button type="primary" icon="md-arrow-down" disabled> 下移 </i-button>
                </button-group>
            </div>
            <div style="clear: both"></div>
        </div>
    </div>
</div>
<script>
    var gridManager = new Vue({
        el: "#gridManager",
        mounted: function () {
            //this.initTree();
        },
        data: {
            acInterface: {
                <!--Tree -->
                getOrganAndUserData: "/Rest/Grid/SSOProxy/OrganAndUser/GetOrganAndUserData",
                groupEditView: "/HTML/SSO/Role/RoleGroupEdit.html"
            },
            <!--Tree-->
            OrganTree:{
                treeSetting: {
                    async: {
                        enable: true,
                        // Ajax 获取数据的 URL 地址
                        url: ""
                    },
                    // 必须使用data
                    data: {
                        key: {
                            name: "organName"
                        },
                        simpleData: {
                            enable: true,
                            idKey: "organId", // id编号命名
                            pIdKey: "organParentId",  // 父id编号命名
                            rootId: 0
                        }
                    },
                    // 回调函数
                    callback: {
                        onClick: function (event, treeId, treeNode) {
                            gridManager.treeNodeSelected(event, treeId, treeNode);
                        },
                        //成功的回调函数
                        onAsyncSuccess: function (event, treeId, treeNode, msg) {
                            gridManager.OrganTree.treeObj.expandAll(true);
                        }
                    }
                },
                treeIdFieldName: "roleGroupId",
                treeObj: null,
                treeSelectedNode: null
            }
        },
        methods: {
            <!--Tree12-->
            initTree: function () {
                var _self=this;
                AjaxUtility.Post(this.acInterface.getOrganAndUserData, {}, function (result) {
                    console.log(result);
                    if(result.success){
                        var treeData=result.data.ALLOrganMinProp;
                        if(treeData!=null&&treeData.length>0){
                            for(var i=0;i<treeData.length;i++) {
                                if(treeData[i].organId!="0") {
                                    treeData[i].icon = "../../../Themes/Png16X16/icons8-registry-editor-16.png";
                                }
                            }
                        }
                        _self.treeObj=$.fn.zTree.init($("#zTreeUL"), _self.OrganTree.treeSetting,treeData);
                        _self.treeObj.expandAll(true);
                    }
                    else {
                        DialogUtility.Alert(window, DialogUtility.DialogAlertId, {}, result.message, function () {});
                    }
                }, this);
            },
            treeNodeSelected: function (event, treeId, treeNode) {
                // 根节点不触发任何事件
                //if(treeNode.level != 0) {
                this.treeSelectedNode = treeNode;
                this.roleList.selectionRows = null;
                this.roleList.pageNum = 1;
                this.clearSearchCondition();
                this.roleList.searchCondition.roleGroupId.value = this.treeSelectedNode[this.treeIdFieldName];
                this.reloadData();
                //appList.reloadTreeTableData();
                //}
            }
        }
    });
</script>
</body>
</html>